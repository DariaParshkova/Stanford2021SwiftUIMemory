//
//  EmojiMemoryGame.swift
//  Memory
//
//  Created by Parshkova Daria on 08.07.2021.
//

import SwiftUI
// ััะพ ViewModel - ัะฒะปัะตััั ัะฐัััั ะฟะพะปัะทะพะฒะฐัะตะปััะบะพะณะพ ะธะฝัะตััะตะนัะฐ, ะฝะพ ััะพ ะฝะต ัะฐััั ะฟัะตะดััะฐะฒะปะตะฝะธั
// ะตั ะทะฐะดะฐัะฐ ะฑััั ะฟะพััะตะดะฝะธะบะพะผ ะผะตะถะดั ะผะพะดะตะปัั ะธ ะฟัะตะดััะฐะฒะปะตะฝะธะตะผ, View Model ัะพะฑะธัะฐะตััั ัะพะทะดะฐัั ัะฒะพั ัะพะฑััะฒะตะฝะฝัั ะผะพะดะตะปั ะะฝะพะณะดะฐ ะะพะดะตะปั ััะพ ัะถะต ัััะตััะฒัััะฐั ัะตัะตะฒะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั ะธ ะพะฝะฐ ะฟัะพััะพ ัะพะฑะธัะฐััั ะฟะพะดะบะปััะธัััั ะบ ะฝะตะน. ะะพ ัะฐััะพ ะพะฝ ัะพะทะดะฐะตั ะผะพะดะตะปั ะบ ะบะพัะพัะพะน ะพะฝ ะฟัะตะดะพััะฐะฒะปัะตั ะพะบะฝะพ, ะธ ะทะฐะดะฐัะฐ ViewModel - ะปะธะฑะพ ะทะฐััะฐะฒะธัั ััั ะฒะตัั ัะพััะฐะฝััััั ะฝะฐ ะดะธัะบะต ะธะปะธ ะฒ ัะตัะธ. ะะพ ะดะปั ะธะณัั ะฒ ะฟะฐะผััั ะดะพััะฐัะพัะฝะพ ัะพะณะณะพ ััะพ ะธะณัะฐ ะฟัะพััะพ ะธััะตะทะฐะตั ะบะพะณะดะฐ ััะฐ ViewModel ััะพะดะธั. Mั ัะฐััะพ ะฑัะดะตะผ ะณะพะฒะพัะธัั ััะพ ะฟัะตะดััะฐะฒะปะตะฝะธั VM ะฑัะดัั truth.
class EmojiMemoryGame : ObservableObject {
    typealias Card = MemoryGame<String>.Card
    
    public var theme: Theme {
        model.theme
    }
    public var score : Int {
        Int(model.score)
    }
    //ะัััะต ะฝะต ะธัะฟะพะปัะทะพะฒะฐัั ะณะปะพะฑะฐะปัะฝัั ะฟะตัะตะผะตะฝะฝัั ัะฐะบ ะบะฐะบ ะบ ะฝะตะน ะธะผะตั ะดะพัััะฟ ะฒัะต, ะดะปั ัะพะณะพ ััะพะฑั ัะดะตะปะฐัั ะฟะตัะตะผะตะฝะฝัั ะฒ ัะฐะผะบะฐั ะฝะฐัะตะณะพ ะฟัะพัััะฐะฝััะฒะฐ ะฟะธัะตะผ STATIC - ะฟะพ ัััะตััะฒั ะพะฝะฐ ะณะปะพะฑะฐะปัะฝ
    @Published private var model : MemoryGame<String>!
    
    private static func createMemoryGame(theme:Theme) -> MemoryGame<String> {
        let emojis = theme.cardContent
        let memoryGame = MemoryGame<String>(theme: theme , numberOfPairsOfCards: emojis.count) { pairIndex in
            emojis[pairIndex]
        }
        memoryGame.cards.shuffled()
        return memoryGame
    }
    init(theme:Theme? = nil ) {
        self.model = EmojiMemoryGame.createMemoryGame(theme: theme ?? EmojiMemoryGame.themes.randomElement()!)
    }
    //ะฟัะตะดะพััะฐะฒะปัะตะผ ััะฝะบัะธั, ะบะพัะพัะฐั ัะดะตะปะฐะตั ะฟะฐัะฐะผะตัั createCardContent
    //ะฒ ะดะฐะฝะฝะพะผ ัะปััะฐะบ STATIC - ะฟะพะดัะตัะบะธะฒะฐะตั ััะพ ััะฐ ััะฝะบัะธั ะฝะฐ ัะฐะผะพะผ ะดะตะปะต ััะฝะบัะธั ัะพะณะพ ะดะต ัะธะฟะฐ EmojiMemoryGame, ะฝะต ัะบะทะตะผะฟะปัะฟะฒ ะฐ ัะฐะผ ัะธะฟ ะธะผะตะตั ััั
    //ััะฝะบัะธั ะธะปะธ ะฟะตัะตะผะตะฝะฝัั
    //emoji - ััะพ ัััะพะบะธ
    //ะะฐะดะฐัะฐ VM ะทะฐัะธัะฐัั ะผะพะดะตะปั ะพั ะฝะตะบะพััะตะบัะฝัั ะฟัะตะดััะฐะฒะปะฝะธะน, ะพะดะธะฝ ะธะท ัะฐะบะธั ัะฟะพัะพะฑะพะฒ ัะดะตะปะฐัั ะตะต private -  ะพะฝะฐ model ะผะพะถะตั ะฒะธะดะตัั ัะพะปัะบะพ ัะฐะผ ะบะพะด VM. ะญัะพ ะบะพะฝััะพะปั ะดะพัััะฟะฐ.

// ะฒ ััััะบัััะฐ var ะผะพะณัั ัััะตััะฒะพะฒะฐัั ะฑะตะท ะทะฝะฐัะตะฝะธะน, ะฝะพ ะฒ ะบะปะฐััะต ัะฐะบ ะฝะตะปัะทั
    var cards: Array<Card> {
        return model.cards
    }
    //ะธะผะตะตั ัะพะฑััะฒะตะฝะฝัะต ะบะฐััั ะธ ะผะพะถะตัั ะฒะพะทะฒัะฐัะฐัั ะบะฐััั ะผะพะดะตะปะธ, ััะพ ััััะบัััะฐ, ะธ ะผะฐััะธะฒั ะธ ะบะฐััั ััะพ ััััะบััั ะบะพะณะดะฐ ะผั ะฟะตัะตะดะฐะตะผ ััััะบัััั ะผั ะธั ะบะพะฟะธััะตะผ. ะะพะณะดะฐ ะบัะพ-ัะพ ะฟะพะฟัะพัะธั ะทะดะตัั VM ะบะฐััั ะฒ ะผะพะดะตะปะธ  ะฝะฐะผ ะฝัะถะฝะพ ะฑัะดะตั ะฟะพะปััะธัั ะฝะพะฒัั ะบะพะฟะธั. ะะพััะพะผั ะฝะฐะผ ะฝัะถะฝะฐ ััะฐ ััะฝะบัะธั, ะบะฐะถะดั ัะฐะท ะบะพะณะดะฐ ะบัะพ-ัะพ ะฟัะพัะธั ะบะฐััะพัะบะธ VM. 
    // MARK: - Intent(s)
    func choose(_ card : Card) {
        model.choose(card:card)
        //ะฝะฐัะฐ ะผะพะดะตะปั ะฟะพะทะฒะพะปัะตั ะฝะฐะผ ะฝะฐะฟััะผัั ะฒัะฑะธัะฐัั ะบะฐััั
    }
    func beginNewGame() {
        model = EmojiMemoryGame.createMemoryGame(theme: randomDifferentTheme)
    }
    func didTouchNewGameButton() {
        beginNewGame()
    }
    func shuffle()  {
        model.shuffle()
    }
    private var  randomDifferentTheme : Theme {
        let randomDifferentThemes = EmojiMemoryGame.themes.filter {$0.name != theme.name}
        return randomDifferentThemes.randomElement()!
    }
    //ััะพ ะฝะฐะผะตัะตะฝะธะต - ัะพ ััะพ ะผั ัะพะฑะธัะฐะตะผัั ะฟะพะปััะธัั Ui ะธะฝัะตััะตะนั ะฝะตะฟะพััะตะดััะฒะตะฝะฝะพ ะบ ะฝะฐัะตะผั ะฟะพะปัะท ะธะฝัะตััะตะนัั
}

extension EmojiMemoryGame {
    typealias Theme = MemoryGame<String>.Theme
    static var themes : [Theme] { [
        Theme(name:"Hallowen", cardContent: ["๐","๐","๐ป","๐งโโ๏ธ","๐ฎ","๐ค","๐","๐งก","๐ซ","๐","๐งโโ๏ธ","๐ง"], numberOfCards: 3, color: .orange),
        Theme(name: "Animals", cardContent: ["๐ถ","๐ฑ","๐ธ","๐ฐ","๐ป","๐ต","๐ฆ","๐ฎ","๐ค","๐ฆ"], numberOfCards: 2, color: .purple),
        Theme(name: "Transport", cardContent: ["๐", "๐", "๐", "๐","๐","๐ณ","๐ธ", "๐","โ๏ธ","โต๏ธ"], numberOfCards: 2, color: .red),
        Theme(name: "Sea", cardContent: ["๐","๐ฆ","๐ฆ","โ๏ธ","๐งโโ๏ธ","๐ถ","๐","๐","๐","๐"], numberOfCards: 2, color: .blue),
        Theme(name: "Eat", cardContent: ["๐","๐ฅ","๐","๐","๐","๐","๐","๐"], numberOfCards: 2, color: .yellow),
        Theme(name: "Medecine", cardContent: ["๐ซ","๐ง","๐","๐ฆพ","๐ฆท","๐","๐ฉบ","๐งฌ","๐งช","๐ฌ"], numberOfCards: 2,color: .green),
        Theme(name: "IT", cardContent: ["๐ป","๐ฟ","๐น","๐ก","๐ก","โจ๏ธ","๐ณ","๐ฑ","๐","โ๏ธ","๐ฅ"], numberOfCards: 2, color: .blue),
        Theme(name: "Hurt", cardContent: ["โค๏ธ","๐ค","๐","๐","๐","๐งก","๐","๐ค","๐","๐ซ"], numberOfCards: 2, color: .pink)
    ]}
}

